// Prisma Schema for Insurance Payment Tracker with Authentication
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User Model (for authentication)
model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  username           String?             @unique
  name               String?
  image              String?
  emailVerified      DateTime?           @map("email_verified")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")

  // Relations
  accounts           Account[]
  sessions           Session[]
  insurancePayments  InsurancePayment[]
  venmoPayments      VenmoPayment[]
  settings           UserSetting?

  @@map("users")
}

// NextAuth Account Model
model Account {
  id                String  @id @default(uuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

// NextAuth Session Model
model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// NextAuth Verification Token
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Tracking Status Enum
enum TrackingStatus {
  PENDING
  RECORDED
  NOTIFIED
  COLLECTED
}

// Insurance Payments Table (with userId)
model InsurancePayment {
  id                 String         @id @default(uuid())
  userId             String         @map("user_id")
  claimStatus        String?        @map("claim_status")
  datesOfService     String?        @map("dates_of_service")
  memberSubscriberID String         @map("member_subscriber_id")
  providerName       String?        @map("provider_name")
  paymentDate        String?        @map("payment_date")
  claimNumber        String?        @map("claim_number")
  checkNumber        String?        @map("check_number")
  checkEFTAmount     Decimal        @default(0) @map("check_eft_amount") @db.Decimal(10, 2)
  payeeName          String         @map("payee_name")
  payeeAddress       String?        @map("payee_address")
  trackingStatus     TrackingStatus @default(PENDING) @map("tracking_status")
  createdAt          DateTime       @default(now()) @map("created_at")
  updatedAt          DateTime       @updatedAt @map("updated_at")

  // Relation
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, memberSubscriberID])
  @@index([userId, payeeName])
  @@index([memberSubscriberID])
  @@index([payeeName])
  @@index([paymentDate])
  @@index([claimNumber])
  @@index([memberSubscriberID, payeeName])
  @@map("insurance_payments")
}

// User Settings Table
model UserSetting {
  id               String   @id @default(uuid())
  userId           String   @unique @map("user_id")
  ignoredAddresses String[] @map("ignored_addresses")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_settings")
}

// Venmo Payments Table (with userId)
model VenmoPayment {
  id                 String   @id @default(uuid())
  userId             String   @map("user_id")
  patientName        String   @map("patient_name")
  memberSubscriberID String   @map("member_subscriber_id")
  amount             Decimal  @db.Decimal(10, 2)
  date               String
  notes              String?
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  // Relation
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, memberSubscriberID])
  @@index([userId, patientName])
  @@index([memberSubscriberID])
  @@index([patientName])
  @@index([date])
  @@index([memberSubscriberID, patientName])
  @@map("venmo_payments")
}
